define(["petitspois","loadin","gf"],function(e,t,n){function a(n){n&&e.ajax({url:"/comment",type:"POST",data:n}).then(function(n){var a=[];if(n=JSON.parse(n),n.status){if(2===n.status)return t.show("alert",n.msg,"success"),void setTimeout(function(){location.pathname="/signin"},700);var s=document.createElement("div");s.className="each-comments fade-in-up",a.push('<a class="pull-left thumb-sm">'),a.push('<img src="'+n.data.avatar+'" class="img-circle">'),a.push('</a><div class="m-l-xxl m-b"><div>'),a.push('<a href=""><strong>'+n.data.name+"</strong></a>"),a.push('<span class="text-muted text-xs block m-t-xs">'+n.data.createtime+"</span>"),a.push(n.data.reply?'</div><div class="m-t-sm reply-wrap"><a href="">@'+n.data.reply+"</a>&nbsp;&nbsp;"+n.data.comment+"</div></div>":'</div><div class="m-t-sm">'+n.data.comment+"</div></div>"),s.innerHTML=a.join(" "),t.hide(),document.body.scrollTop=77777,document.getElementById("wrap-comments").appendChild(s),e(s).addClass("ng-enter")}else t.show("alert",n.msg,"danger")},function(){})}e("#comment-btn").on("click",function(){var e=document.getElementById("comment-content").value||"",n=location.pathname,s=n.slice(n.lastIndexOf("/")+1)||-1;t.show("load"),a({comment:e,pid:s})});var s=e("#delete-comment");s.on("click",function(){var a=e(this).parent("each-comments"),s=a.attr("id")||0;if(s){var i=confirm("确定要删除评论？将会扣除相应的积分");if(!i)return;t.show("load"),e.ajax({url:"/removecomment",type:"POST",data:{cid:s}}).then(function(e){e=JSON.parse(e),t.hide(),e.status?(n("success",e.msg),a.remove()):n("error",e.msg)},function(){})}}),e("#reply-comment").on("click",function(){var t=e(this).parent().siblings().siblings();t.hasClass("ng-enter")||t.removeClass("hide").addClass("ng-enter")}),e("#reply-btn").on("click",function(){var t=e(this).parent()[0].previousElementSibling,n=t.value,s=t.previousElementSibling.getAttribute("reply-name"),i=location.pathname.slice(location.pathname.lastIndexOf("/")+1)||-1;a({comment:n,pid:i,reply:s}),setTimeout(function(){e(".reply").each(function(){e(this).hasClass("ng-enter")&&e(this).remove("ng-enter")})})})});